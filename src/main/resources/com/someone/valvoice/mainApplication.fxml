<?xml version="1.0" encoding="UTF-8"?>

<?import com.jfoenix.controls.JFXToggleButton?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>
<?import java.lang.String?>

<AnchorPane prefHeight="650.0" prefWidth="900.0" styleClass="root" stylesheets="@style.css"
            xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.someone.valvoice.ValVoiceController">

    <!-- ========== TOP BAR (Draggable) ========== -->
    <AnchorPane fx:id="topBar" prefHeight="50.0" prefWidth="900.0" styleClass="top-bar"
                AnchorPane.topAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0">
        <HBox alignment="CENTER_LEFT" prefHeight="50.0" prefWidth="900.0" spacing="10">
            <padding><Insets left="20" /></padding>

            <!-- App Icon -->
            <ImageView fitHeight="30.0" fitWidth="30.0" preserveRatio="true">
                <image>
                    <Image url="@icons/logo.png" />
                </image>
            </ImageView>

            <!-- Title directly (removed unnecessary VBox) -->
            <Label fx:id="windowTitle" text="ValVoice" styleClass="window-title">
                <font>
                    <Font name="System Bold" size="18.0" />
                </font>
            </Label>
        </HBox>
    </AnchorPane>

    <!-- ========== NAVIGATION SIDEBAR (anchored) ========== -->
    <VBox AnchorPane.topAnchor="50.0" AnchorPane.leftAnchor="0.0" AnchorPane.bottomAnchor="0.0"
          prefWidth="100.0" styleClass="sidebar" spacing="20" alignment="TOP_CENTER">
        <padding><Insets top="30" /></padding>

        <!-- Info Button with icon -->
        <VBox alignment="CENTER" spacing="5" styleClass="nav-item">
            <Button fx:id="btnInfo" onMouseClicked="#handleButtonAction" styleClass="nav-button" prefWidth="45" prefHeight="45" text="">
                <graphic>
                    <ImageView fitWidth="26" fitHeight="26" preserveRatio="true">
                        <image><Image url="@icons/info.png" /></image>
                    </ImageView>
                </graphic>
            </Button>
            <Label text="Info" styleClass="nav-label" />
        </VBox>

        <!-- User Button with icon -->
        <VBox alignment="CENTER" spacing="5" styleClass="nav-item">
            <Button fx:id="btnUser" onMouseClicked="#handleButtonAction" styleClass="nav-button" prefWidth="45" prefHeight="45" text="">
                <graphic>
                    <ImageView fitWidth="26" fitHeight="26" preserveRatio="true">
                        <image><Image url="@icons/user.png" /></image>
                    </ImageView>
                </graphic>
            </Button>
            <Label text="Profile" styleClass="nav-label" />
        </VBox>

        <!-- Settings Button with icon -->
        <VBox alignment="CENTER" spacing="5" styleClass="nav-item">
            <Button fx:id="btnSettings" onMouseClicked="#handleButtonAction" styleClass="nav-button" prefWidth="45" prefHeight="45" text="">
                <graphic>
                    <ImageView fitWidth="26" fitHeight="26" preserveRatio="true">
                        <image><Image url="@icons/settings.png" /></image>
                    </ImageView>
                </graphic>
            </Button>
            <Label text="Settings" styleClass="nav-label" />
        </VBox>
    </VBox>

    <!-- ========== PANELS AREA (anchored) ========== -->
    <AnchorPane AnchorPane.topAnchor="50.0" AnchorPane.leftAnchor="100.0" AnchorPane.rightAnchor="0.0" AnchorPane.bottomAnchor="0.0">
        <!-- ========== LOGIN PANEL ========== -->
        <AnchorPane fx:id="panelLogin" visible="true" styleClass="content-panel"
                    AnchorPane.topAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" AnchorPane.bottomAnchor="0.0">
            <VBox alignment="CENTER" prefHeight="600.0" prefWidth="800.0" spacing="30">
                <!-- Logo/Icon -->
                <ImageView fitHeight="100.0" fitWidth="100.0" preserveRatio="true">
                    <image>
                        <Image url="@icons/logo.png" />
                    </image>
                </ImageView>

                <Label text="ðŸŽ¤" style="-fx-font-size: 60px;" />

                <!-- Loading Text -->
                <Label fx:id="progressLoginLabel" text="Initializing ValVoice..."
                       styleClass="loading-label">
                    <font>
                        <Font name="System" size="20.0" />
                    </font>
                </Label>

                <!-- Progress Bar -->
                <ProgressBar fx:id="progressLogin" prefWidth="400.0" progress="0.0"
                             styleClass="progress-bar" />

                <!-- Version Info -->
                <Label text="Version 1.0.0" styleClass="version-label">
                    <font>
                        <Font size="12.0" />
                    </font>
                </Label>
            </VBox>
        </AnchorPane>

        <!-- ========== INFO PANEL ========== -->
        <ScrollPane fx:id="scrollInfo" fitToWidth="true" visible="false" styleClass="scroll-pane"
                    AnchorPane.topAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" AnchorPane.bottomAnchor="0.0">
            <AnchorPane fx:id="panelInfo" prefWidth="780.0" styleClass="content-panel" visible="false">
                <VBox spacing="25" prefWidth="780.0">
                    <padding><Insets top="0" left="0" right="0" bottom="20" /></padding>

                    <!-- Header without icon -->
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <VBox>
                            <Label text="Information" styleClass="page-title">
                                <font><Font name="System Bold" size="28.0" /></font>
                            </Label>
                            <Label text="About ValVoice and support" styleClass="page-subtitle" />
                        </VBox>
                    </HBox>

                    <Separator />

                    <!-- About Card -->
                    <VBox styleClass="card" spacing="15">
                        <padding>
                            <Insets top="20" left="25" right="25" bottom="20" />
                        </padding>

                        <Label text="About ValVoice" styleClass="card-title">
                            <font>
                                <Font name="System Bold" size="18.0" />
                            </font>
                        </Label>

                        <Label text="ValVoice is a voice narration tool for Valorant that reads in-game chat messages using text-to-speech technology."
                               styleClass="info-text" wrapText="true" />

                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="Version:" styleClass="info-label" />
                            <Label text="1.0.0" styleClass="info-value" />
                        </HBox>
                    </VBox>

                    <!-- Support Card -->
                    <VBox styleClass="card" spacing="15">
                        <padding>
                            <Insets top="20" left="25" right="25" bottom="20" />
                        </padding>

                        <Label text="Support &amp; Community" styleClass="card-title">
                            <font>
                                <Font name="System Bold" size="18.0" />
                            </font>
                        </Label>

                        <Label text="Join our community for support, updates, and feature requests."
                               styleClass="info-text" wrapText="true" />

                        <Button text="Join Discord Server" onAction="#openDiscordInvite"
                                styleClass="discord-button" prefWidth="200.0" />
                    </VBox>

                    <!-- How It Works Card -->
                    <VBox styleClass="card" spacing="15">
                        <padding>
                            <Insets top="20" left="25" right="25" bottom="20" />
                        </padding>

                        <Label text="How It Works" styleClass="card-title">
                            <font>
                                <Font name="System Bold" size="18.0" />
                            </font>
                        </Label>

                        <VBox spacing="12">
                            <HBox spacing="12" alignment="TOP_LEFT">
                                <Label text="1." styleClass="step-number" />
                                <Label text="ValVoice connects to Valorant's chat system"
                                       styleClass="info-text" wrapText="true" />
                            </HBox>
                            <HBox spacing="12" alignment="TOP_LEFT">
                                <Label text="2." styleClass="step-number" />
                                <Label text="Messages from selected channels are captured"
                                       styleClass="info-text" wrapText="true" />
                            </HBox>
                            <HBox spacing="12" alignment="TOP_LEFT">
                                <Label text="3." styleClass="step-number" />
                                <Label text="Text is converted to speech using your selected voice"
                                       styleClass="info-text" wrapText="true" />
                            </HBox>
                            <HBox spacing="12" alignment="TOP_LEFT">
                                <Label text="4." styleClass="step-number" />
                                <Label text="Audio is played through your configured output device"
                                       styleClass="info-text" wrapText="true" />
                            </HBox>
                        </VBox>
                    </VBox>
                </VBox>
            </AnchorPane>
        </ScrollPane>

        <!-- ========== USER PANEL ========== -->
        <ScrollPane fx:id="scrollUser" fitToWidth="true" visible="false" styleClass="scroll-pane"
                    AnchorPane.topAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" AnchorPane.bottomAnchor="0.0">
            <AnchorPane fx:id="panelUser" prefWidth="780.0" styleClass="content-panel" visible="false">
                <VBox spacing="25" prefWidth="780.0">
                    <padding><Insets top="0" left="0" right="0" bottom="20" /></padding>

                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <VBox>
                            <Label text="Dashboard" styleClass="page-title">
                                <font><Font name="System Bold" size="28.0" /></font>
                            </Label>
                            <Label text="Your account overview" styleClass="page-subtitle" />
                        </VBox>
                    </HBox>

                    <Separator />

                    <!-- User Info Card -->
                    <VBox styleClass="card" spacing="15">
                        <padding>
                            <Insets top="20" left="25" right="25" bottom="20" />
                        </padding>

                        <Label text="Account Information" styleClass="card-title">
                            <font>
                                <Font name="System Bold" size="18.0" />
                            </font>
                        </Label>

                        <GridPane hgap="20" vgap="15">
                            <!-- User ID -->
                            <Label text="User ID:" styleClass="info-label" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                            <Label fx:id="userIDLabel" text="Loading..." styleClass="info-value"
                                   GridPane.columnIndex="1" GridPane.rowIndex="0" />
                        </GridPane>
                    </VBox>

                    <!-- Quota Card -->
                    <VBox styleClass="card" spacing="15">
                        <padding>
                            <Insets top="20" left="25" right="25" bottom="20" />
                        </padding>

                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="Daily Quota" styleClass="card-title">
                                <font>
                                    <Font name="System Bold" size="18.0" />
                                </font>
                            </Label>
                            <Region HBox.hgrow="ALWAYS" />
                            <Label fx:id="quotaLabel" text="0/100" styleClass="quota-label">
                                <font>
                                    <Font name="System Bold" size="16.0" />
                                </font>
                            </Label>
                        </HBox>

                        <ProgressBar fx:id="quotaBar" prefWidth="Infinity" prefHeight="12.0"
                                     progress="0.0" styleClass="quota-bar" />

                        <Label text="Resets daily at 00:00 UTC" styleClass="hint-label" />
                    </VBox>

                    <!-- Statistics Card -->
                    <VBox styleClass="card" spacing="20">
                        <padding>
                            <Insets top="20" left="25" right="25" bottom="20" />
                        </padding>

                        <Label text="Usage Statistics" styleClass="card-title">
                            <font>
                                <Font name="System Bold" size="18.0" />
                            </font>
                        </Label>

                        <HBox spacing="40">
                            <!-- Messages Sent -->
                            <VBox styleClass="stat-box" spacing="8" alignment="CENTER" HBox.hgrow="ALWAYS">
                                <Label text="Messages Sent" styleClass="stat-label" />
                                <Label fx:id="messagesSentLabel" text="0" styleClass="stat-value">
                                    <font>
                                        <Font name="System Bold" size="32.0" />
                                    </font>
                                </Label>
                            </VBox>

                            <!-- Characters Narrated -->
                            <VBox styleClass="stat-box" spacing="8" alignment="CENTER" HBox.hgrow="ALWAYS">
                                <Label text="Characters Narrated" styleClass="stat-label" />
                                <Label fx:id="charactersNarratedLabel" text="0" styleClass="stat-value">
                                    <font>
                                        <Font name="System Bold" size="32.0" />
                                    </font>
                                </Label>
                            </VBox>
                        </HBox>
                    </VBox>
                </VBox>
            </AnchorPane>
        </ScrollPane>

        <!-- ========== SETTINGS PANEL ========== -->
        <ScrollPane fx:id="scrollSettings" fitToWidth="true" visible="false" styleClass="scroll-pane"
                    AnchorPane.topAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" AnchorPane.bottomAnchor="0.0">
            <AnchorPane fx:id="panelSettings" prefWidth="780.0" styleClass="content-panel" visible="false">
                <VBox spacing="25" prefWidth="780.0">
                    <padding><Insets top="0" left="0" right="0" bottom="20" /></padding>

                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <VBox>
                            <Label text="Settings" styleClass="page-title">
                                <font><Font name="System Bold" size="28.0" /></font>
                            </Label>
                            <Label text="Configure your preferences" styleClass="page-subtitle" />
                        </VBox>
                    </HBox>

                    <Separator />

                    <!-- Voice Settings Card -->
                    <VBox styleClass="card" spacing="20">
                        <padding>
                            <Insets top="20" left="25" right="25" bottom="20" />
                        </padding>

                        <Label text="Voice Settings" styleClass="card-title">
                            <font>
                                <Font name="System Bold" size="18.0" />
                            </font>
                        </Label>

                        <VBox spacing="15">
                            <!-- Voice Selection -->
                            <VBox spacing="8">
                                <Label text="Voice" styleClass="setting-label" />
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <ComboBox fx:id="voices" prefWidth="Infinity" maxWidth="500.0"
                                              onAction="#selectVoice" promptText="Select a voice"
                                              styleClass="setting-combo" HBox.hgrow="ALWAYS" />
                                    <Button text="Refresh" onAction="#refreshVoices" styleClass="secondary-button" />
                                </HBox>
                                <Label text="Choose the voice for text-to-speech narration"
                                       styleClass="hint-label" />
                            </VBox>

                            <!-- Speech Rate -->
                            <VBox spacing="8">
                                <Label text="Speech Rate" styleClass="setting-label" />
                                <HBox spacing="15" alignment="CENTER_LEFT">
                                    <Label text="Slow" styleClass="hint-label" />
                                    <Slider fx:id="rateSlider" prefWidth="400.0"
                                            min="0" max="100" value="50"
                                            showTickMarks="false" styleClass="setting-slider" />
                                    <Label text="Fast" styleClass="hint-label" />
                                </HBox>
                            </VBox>
                        </VBox>
                    </VBox>

                    <!-- Chat Settings Card -->
                    <VBox styleClass="card" spacing="20">
                        <padding>
                            <Insets top="20" left="25" right="25" bottom="20" />
                        </padding>

                        <Label text="Chat Settings" styleClass="card-title">
                            <font>
                                <Font name="System Bold" size="18.0" />
                            </font>
                        </Label>

                        <VBox spacing="15">
                            <!-- Chat Source -->
                            <VBox spacing="8">
                                <Label text="Chat Source" styleClass="setting-label" />
                                <ComboBox fx:id="sources" prefWidth="Infinity" maxWidth="500.0"
                                          onAction="#selectSource" promptText="Select chat source"
                                          styleClass="setting-combo" />
                                <Label text="Choose which chat channels to narrate"
                                       styleClass="hint-label" />
                            </VBox>

                            <!-- Keybind -->
                            <VBox spacing="8">
                                <Label text="Team Chat Keybind" styleClass="setting-label" />
                                <TextField fx:id="keybindTextField" prefWidth="200.0" maxWidth="200.0"
                                           promptText="Click and press key..." editable="false"
                                           styleClass="keybind-field" />
                                <Label text="Set push-to-talk key for team chat"
                                       styleClass="hint-label" />
                            </VBox>
                        </VBox>
                    </VBox>

                    <!-- Feature Toggles Card -->
                    <VBox styleClass="card" spacing="20">
                        <padding>
                            <Insets top="20" left="25" right="25" bottom="20" />
                        </padding>

                        <Label text="Features" styleClass="card-title">
                            <font>
                                <Font name="System Bold" size="18.0" />
                            </font>
                        </Label>

                        <VBox spacing="18">
                            <!-- Microphone Toggle -->
                            <HBox alignment="CENTER_LEFT" spacing="15">
                                <VBox HBox.hgrow="ALWAYS">
                                    <Label text="Microphone" styleClass="setting-label" />
                                    <Label text="Enable microphone passthrough" styleClass="hint-label" />
                                </VBox>
                                <JFXToggleButton fx:id="micButton" onAction="#toggleMic"
                                                 styleClass="toggle-button" />
                            </HBox>

                            <Separator prefWidth="Infinity" />

                            <!-- Private Messages Toggle -->
                            <HBox alignment="CENTER_LEFT" spacing="15">
                                <VBox HBox.hgrow="ALWAYS">
                                    <Label text="Private Messages" styleClass="setting-label" />
                                    <Label text="Narrate private/whisper messages" styleClass="hint-label" />
                                </VBox>
                                <JFXToggleButton fx:id="privateChatButton"
                                                 onAction="#togglePrivateMessages"
                                                 styleClass="toggle-button" />
                            </HBox>

                            <Separator prefWidth="Infinity" />

                            <!-- Team Chat Toggle -->
                            <HBox alignment="CENTER_LEFT" spacing="15">
                                <VBox HBox.hgrow="ALWAYS">
                                    <Label text="Team Chat PTT" styleClass="setting-label" />
                                    <Label text="Enable push-to-talk for team chat" styleClass="hint-label" />
                                </VBox>
                                <JFXToggleButton fx:id="teamChatButton" onAction="#toggleTeamChat"
                                                 styleClass="toggle-button" />
                            </HBox>

                            <Separator prefWidth="Infinity" />

                            <!-- Valorant Settings Sync -->
                            <HBox alignment="CENTER_LEFT" spacing="15">
                                <VBox HBox.hgrow="ALWAYS">
                                    <Label text="Sync Valorant Settings" styleClass="setting-label" />
                                    <Label text="Automatically sync voice settings with Valorant"
                                           styleClass="hint-label" />
                                </VBox>
                                <JFXToggleButton fx:id="valorantSettings" styleClass="toggle-button" />
                            </HBox>
                        </VBox>

                        <HBox spacing="15">
                            <Button fx:id="voiceSettingsSync" text="Sync Now"
                                    onAction="#syncValorantSettings" styleClass="secondary-button" />
                        </HBox>
                    </VBox>

                    <!-- Player Management Card -->
                    <VBox styleClass="card" spacing="20">
                        <padding>
                            <Insets top="20" left="25" right="25" bottom="20" />
                        </padding>

                        <Label text="Player Management" styleClass="card-title">
                            <font>
                                <Font name="System Bold" size="18.0" />
                            </font>
                        </Label>

                        <VBox spacing="15">
                            <!-- Add Ignored Player -->
                            <VBox spacing="8">
                                <Label text="Ignore Player" styleClass="setting-label" />
                                <HBox spacing="10">
                                    <ComboBox fx:id="addIgnoredPlayer" prefWidth="300.0"
                                              promptText="Select player to ignore"
                                              styleClass="setting-combo" HBox.hgrow="ALWAYS" />
                                    <Button text="Ignore" onAction="#ignorePlayer"
                                            styleClass="secondary-button" />
                                </HBox>
                            </VBox>

                            <!-- Remove Ignored Player -->
                            <VBox spacing="8">
                                <Label text="Unignore Player" styleClass="setting-label" />
                                <HBox spacing="10">
                                    <ComboBox fx:id="removeIgnoredPlayer" prefWidth="300.0"
                                              promptText="Select player to unignore"
                                              styleClass="setting-combo" HBox.hgrow="ALWAYS" />
                                    <Button text="Unignore" onAction="#unignorePlayer"
                                            styleClass="secondary-button" />
                                </HBox>
                            </VBox>
                        </VBox>
                    </VBox>
                </VBox>
            </AnchorPane>
        </ScrollPane>
    </AnchorPane>
</AnchorPane>
